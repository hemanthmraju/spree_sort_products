
<%= render :partial => 'spree/admin/shared/configuration_menu' %>

<% content_for :page_title do %>
  <%= t(:sort_taxon_products) %> "<%= @taxon.name %>"
<% end %>

<%= t(:sort_products_hint_message) %>

<div id="ajax_error" class="errorExplanation" style="display:none;"></div>
<% content_for :page_actions do %>
  <% # Because otherwise the form would attempt to use to_param of @taxon %>
  <% form_url = update_products_admin_taxonomy_taxon_path(@taxonomy.id, @taxon.id) %>
  <%= form_for [:update_products, :admin, @taxonomy, @taxon], :method => :post, :url => form_url do |f| %>
    <%= hidden_field_tag :taxon_id, @taxon_id %>
    <%= hidden_field_tag :product_positions, 0 %>

      <li id="save_order">
        <%= button_link_to t(:back_to_taxonomies_list), spree.admin_taxonomies_path, :icon => 'icon-arrow-left' %>
      </li>
  <% end %>
  
  <% form_url = sort_hand_count_admin_taxonomy_taxon_path(@taxonomy.id, @taxon.id) %>
  
  <%= form_for [:sort_hand_count, :admin, @taxonomy, @taxon], :method => :post, :url => form_url do |f| %>
    <%= hidden_field_tag :taxon_id, @taxon_id %>
    <%= submit_tag "count on sort" %>
  <% end %>

   

<% end %>

<ul id="products" class="thumbnails">
  <% @products.each do |product| %>
    <%= content_tag_for :li, product, :class=> "three columns", :style => 'height: 300px; list-style-type: none' do %>
      <div class="two columns thumbnail" style = "cursor: pointer;" value="<%= product.id %>">
          <%= product_image(product, :width => "145", :height => "190", :id=>"image-map") %>
          <div class="caption">
            <% product_name = product.name.split(" ") %>
            <% product_name.delete(product_name.last) %>
            <h5><%= product_name.join(" ") %></h5>
          </div>
      </div>
    <% end %>
  <% end %>
</ul>
<script type="text/javascript">
var saveOrder;

saveOrder = function() {
  var data;
  data = $("#products li").map(function() {
    return $(this).children().attr("value");
  }).get();
  $("input[name=product_positions]").val(data.join(","));
  return $("#save_order").html('<button class="button btn-primary"><i class="icon-ok icon-white"></i> <%= I18n.t(:save_sorted_order) %></button>');
};

$("#products, #list2").dragsort({
  dragSelector: "div",
  dragBetween: true,
  dragEnd: saveOrder,
  placeHolderTemplate: "<li class='placeHolder'><div></div></li>"
});
</script>
<%#= javascript_include_tag 'admin/sort_products' %>
